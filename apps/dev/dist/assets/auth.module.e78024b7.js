import{c as g,m as l,_ as u}from"./index.791a460c.js";import{m as p}from"./machine.26234c57.js";const f={initialising:{tokenInvalid:()=>"refreshingToken",tokenValid:()=>"loggedIn"},loggedIn:{fetchUserFailure:()=>"loggedOut",logout:()=>"loggedOut"},loggingIn:{loginSuccess:()=>"loggedIn",loginFailure:()=>"loggedOut"},loggedOut:{clickLogin:()=>"loginForm",clickSignup:()=>"signupForm",fetchUserSuccess:()=>"loggedIn"},loginForm:{cancelLogin:()=>"loggedOut",submitLoginForm:()=>"loggingIn"},refreshingToken:{refreshTokenSuccess:()=>"loggedIn",refreshTokenFailure:()=>"loggedOut"},signingUp:{signupFailure:()=>"loggedOut",signupSuccess:()=>"loggedOut"},signupForm:{cancelSignup:()=>"loggedOut",submitSignupForm:()=>"signingUp"}},m={machineState:"initialising",user:null};function h(t,n){const e=p(f,{initialState:"initialising"}),r=g()(t,m,{cancelLogin:()=>async({api:i})=>{e.cancelLogin()},cancelSignup:()=>async({api:i})=>{e.cancelSignup()},clickLogin:()=>async({api:i})=>{e.clickLogin()},clickSignup:()=>async({api:i})=>{e.clickSignup()},fetchUser:()=>async()=>{try{const i=await n.user();a(i)?e.fetchUserFailure():e.fetchUserSuccess()}catch{e.fetchUserFailure()}},init:()=>async({api:i})=>{try{if(await n.checkLocalUser())e.tokenValid();else{e.tokenInvalid();try{const s=await n.refreshToken();if(a(s))e.refreshTokenFailure();else{e.refreshTokenSuccess();const{user:o,...k}=s}}catch{e.refreshTokenFailure();return}}i.fetchUser()}catch(c){throw c}},setMachineState:(i,c)=>l(i,{machineState:c}),submitLoginForm:(i,{email:c,password:s})=>async()=>{try{await e.submitLoginForm()==="loggingIn"&&await n.login(c,s),e.loginSuccess()}catch{e.loginFailure()}},submitSignupForm:(i,{email:c,password:s})=>async()=>{try{await e.submitSignupForm()==="signingUp"&&await n.signUp(c,s),e.signupSuccess()}catch{e.signupFailure()}}});return e.onEnter(i=>{r.api.setMachineState(i.current)}),r}function a(t){const n=t;return typeof n.code=="number"&&typeof n.msg=="string"||typeof n.error=="string"||n===!1}function S(t){return{clickLogin:t.clickLogin,clickSignup:t.clickSignup}}function d(t){return{user:t.auth.user}}async function U(t){const{actions:n,api:e,middleware:r,reducer:i}=h("auth",t);return{actions:n,create:c,middleware:r,reducer:i,services:{api:{factory:()=>Promise.resolve(()=>e)}},views:{userNav:{selectActions:()=>S(e),selectData:d,factory:()=>u(()=>import("./user-nav.view.7dea13d6.js"),["assets/user-nav.view.7dea13d6.js","assets/lit-html.9b9017eb.js"]).then(s=>s.createUserNavView),root:"user-nav"}}};function c(){e.init()}}export{U as createAuthModule};
