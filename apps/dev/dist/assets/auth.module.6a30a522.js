import{s as g,_ as l}from"./index.b4ef96aa.js";import{c as m}from"./event-emitter.2752b338.js";import{m as f}from"./machine.cc32e4a0.js";async function h(n){const i=m(),e=f({initialising:{tokenInvalid:()=>"refreshingToken",tokenValid:()=>"loggedIn"},loginForm:{cancelLogin:()=>"loggedOut",submitLoginForm:()=>"loggingIn"},loggedIn:{fetchUserFailure:()=>"loggedOut",logout:()=>"loggedOut"},loggingIn:{loginSuccess:()=>"loggedIn",loginFailure:()=>"loggedOut"},loggedOut:{clickLogin:()=>"loginForm",clickSignup:()=>"signupForm",fetchUserSuccess:()=>"loggedIn"},refreshingToken:{refreshTokenSuccess:()=>"loggedIn",refreshTokenFailure:()=>"loginForm"},signupForm:{cancelSignup:()=>"loggedOut",submitSignupForm:()=>"signingUp"},signingUp:{signupFailure:()=>"signupForm",signupSuccess:()=>"unconfirmed"}},{initialState:"initialising"});return s(),{clickLogin:()=>{e.clickLogin()},clickSignup:()=>{e.clickSignup()},submitLoginForm:u,submitSignupForm:a};async function o(){try{const t=n.user();e.fetchUserSuccess(),i.emit("user",t)}catch{e.fetchUserFailure()}}async function s(){try{if(await n.checkLocalUser())e.tokenValid();else{e.tokenInvalid();try{const c=await n.refreshToken();e.refreshTokenSuccess(),i.emit("newToken",c)}catch{e.refreshTokenFailure();return}}o()}catch(t){throw t}}async function u(t,c){try{await e.submitLoginForm()==="loggingIn"&&await n.login(t,c),e.loginSuccess()}catch{e.loginFailure()}}async function a(t,c){try{await e.submitSignupForm()==="signingUp"&&await n.signUp(t,c),e.signupSuccess()}catch{e.signupFailure()}}}const S={user:null};function k(){return g({setUser:(n,i)=>({...n,user:i})},{initialState:S,name:"auth"})}function d(n){return n.auth}function p(n){const{clickLogin:i,clickSignup:e}=n;return{clickLogin:i,clickSignup:e}}async function y(n){const i=await h(n),{actions:e,reducer:o}=k();return{actions:e,reducer:o,views:{userNav:{selectActions:()=>p(i),selectData:d,factory:()=>l(()=>import("./user-nav.view.ca5b4480.js"),["assets/user-nav.view.ca5b4480.js","assets/lit-html.d638b774.js"]).then(s=>s.createUserNavView),root:"user-nav"}}}}export{y as createAuthModule};
