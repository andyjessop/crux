import{c as M}from"./event-emitter.2752b338.js";const O=/:\w[\w\d_]*(<[^>]+>)?/g;function A(e){const t=e.match(O)||[];for(let n=0;n<t.length;n++){const r=t[n],o=r.slice(r.indexOf("<")+1,r.length-1);e=e.replace(o,encodeURIComponent(o))}return e}function k(e){return decodeURIComponent(e.replace(/^#/,""))}function x(e){if(e[0]===":"){let t=null;const n=e.indexOf("<");let r=e.slice(1,e.length);if(n>=0){if(e[e.length-1]!==">")throw new Error("No closing >");const o=e.slice(n+1,e.length-1);t=new RegExp(`^(${o})$`),r=e.slice(1,n)}return function(c,u,d=!1){return d?u[r]=[].concat(u[r]||[],c):u[r]=c,!(t&&!t.test(c))}}else return function(n){return n===e}}function j(e){const t=e.map(x);return function(r,o){if(e.length!==r.length)return!1;for(let c=0;c<e.length;c++)if(!t[c](r[c],o))return!1;return!0}}function R(e){return e.endsWith("*")}function v(e){return e.endsWith("?")}function I(e){return v(e)||R(e)?e.slice(0,-1):e}function D(e){const t=Array.from(e.keys()),n=t.map(r=>{const o=e.get(r);return o?x(o):null}).filter(r=>r!==null);return function(o,c){var d;const u=Array.from(o.keys());if(!t.every(s=>v(s)||R(s)||u.includes(s)))return!1;for(let s=0;s<t.length;s++){const l=I(t[s]),g=o.get(l);if(!g)return!1;if(R(t[s]))Array.from(o.entries()).filter(w=>w[0]===l).forEach(w=>{var E;return(E=n[s])==null?void 0:E.call(n,w[1],c,!0)});else if(!((d=n[s])!=null&&d.call(n,g,c))&&!v(t[s]))return!1}return!0}}function L(e){return new URL(`ftp://x/${e}`)}function m(e){return e.replace(/(\/$)|(^\/)/g,"")}function P(e){return m(e).split("/").map(decodeURIComponent)}function N(e){if(e[0]!=="/")throw new Error("Must start with /");const t=L(A(m(e))),n=P(m(t.pathname)),r=k(t.hash),o=D(t.searchParams),c=j(n),u=x(r);return function(s){const l=new URL(s),g={};return c(P(m(l.pathname)),g)&&o(l.searchParams,g)&&u(k(l.hash),g)?g:null}}function U(e,t){const n=e.match(O)||[];for(let r=0;r<n.length;r++){const o=n[r],c=o.indexOf("<");let u=o.slice(1,c<0?o.length:c);if((v(u)||R(u))&&(u=u.slice(0,-1)),!(u in t))throw new Error(`${u} ${void 0}`);e=e.replace(o,t[u])}return e}function W(e){const t=A(m(e)),n=L(t),r=P(n.pathname);return function(c){const u=L("");return u.pathname=r.map(d=>U(d,c)).join("/"),n.searchParams.forEach((d,s)=>{const l=I(s);R(s)?[].concat(c[l]).filter(Boolean).forEach(g=>{u.searchParams.append(l,U(g,c))}):(!v(s)||c[l])&&u.searchParams.set(l,U(d,c))}),u.hash=U(decodeURIComponent(n.hash),c),`${u}`.replace("ftp://x","")}}function H(e){for(const t in e)if(e.hasOwnProperty(t))if(Array.isArray(e[t]))for(let n=0;n<e[t].length;n++)e[t][n]=e[t][n].toString();else e[t]=e[t]?e[t].toString():null;return e}function Q(e,t=""){const n=M(),r=m(t),o=[["root","/"],["notFound","/404"],...Object.entries(e)].reduce((i,[a,f])=>{const h=$(a,f);return h&&(i[a]=h),i},{});return window.addEventListener("popstate",S),S(),{back:g,destroy:c,...n,forward:w,getCurrentRoute:d,go:l,navigate:E,register:$,replace:b};function c(){window.removeEventListener("popstate",S)}function u(i){if(typeof i>"u")return null;const a=`${r}${i}`;return{decodeURL:N(a),encodeURL:W(a)}}function d(){const i=s(window.location.href);if(!i)return null;const{name:a,decodeURL:f}=i,h=f(window.location.href);return h?{name:a,params:h}:null}function s(i){var a;return(a=Object.values(o).find(f=>f.decodeURL(i)))!=null?a:o.notFound}function l(i){window.history.go(i)}function g(){window.history.go(-1)}function w(){window.history.go(1)}async function E(i,a={}){return o[i]?p(i,a):p("notFound")}async function S(){const i=s(window.location.href);if(!i)return;const{name:a,decodeURL:f}=i,h=f(window.location.href);if(!h)return;const y={name:a,params:h};await n.emit("routeDidChange",{current:y,type:"routeDidChange"}),n.emit("ready",{current:y,type:"ready"})}function $(i,a){if(typeof a>"u"||typeof i>"u")return null;const f=u(a);return f?{...f,name:i}:null}async function b(i,a={}){const f=o[i];return f?p(f.name,a,!0):p("notFound")}async function p(i,a={},f=!1){let h;const y=d(),F={name:i,params:a};try{h=o[i].encodeURL(H(a))}catch{return n.emit("routeChangeFailed",{current:y,next:F,type:"routeChangeFailed"}),p("notFound")}if(!h)return n.emit("routeChangeFailed",{current:y,next:F,type:"routeChangeFailed"}),p("notFound");const C=`${window.location.origin}${h}`;C!==window.location.href&&(f?window.history.replaceState({name:i,params:a},"",C):window.history.pushState({name:i,params:a},"",C),S())}}const _={navigate:e=>({type:"router/navigate",payload:e}),_navigated:e=>({type:"router/_navigated",payload:e})};function T(e,t){const n=t!=null?t:Q(e),r=n.getCurrentRoute();if(!r)throw new Error("Current route not found");const c=K({route:r});return{actions:_,middleware:q(n),reducer:c}}function q(e){return function(n){return e.on("routeDidChange",r=>{const o=r.current;o!==null&&n.dispatch(_._navigated(o))}),function(o){return function(u){if(u.type.startsWith("router"))switch(u.type){case"router/navigate":e.navigate(u.payload),o(u);break}o(u)}}}}function K(e){return function(n=e,r){switch(r.type){case"router/_navigated":return{...n,route:r.payload};default:return n}}}function G(){return T({users:"/users",user:"/users/:id"})}export{G as createRouterModule};
